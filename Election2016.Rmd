---
title: "2016 US Elections"
date: "`r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`"
output: 
  html_document:
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE, fig.width=8)
setwd("~/Dropbox/DataScience/Projects/Election2016")
```

The data in this report (unless otherwise noted) comes from using the `pollstR` package.  It allows for direct access to the *HuffPost Pollster* API using `R`.  The code appears on [Github](https://github.com/daniel-park/Election2016).


```{r init}
library(pollstR)

# Available charts, list of 2
#   List 1: `$charts` shows available charts
#   List 2: `$estimates` shows today's estimates for candidates, 
#           approval ratings, etc.
charts <- pollster_charts(page=1) # is this necessary?
# Result:
# View(charts$charts)  # listing by name


```

###National Polling Estimate on `r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`
```{r US_table}
library(pollstR)
# Chart name for various national polls.
slug <- "2016-general-election-trump-vs-clinton-vs-johnson"



source("Election2016_EstTable.R")


candidate.DT
```

## National Polling Data {.tabset .tabset-fade .tabset-pills}

### National Polls  

National support for the two main US presidential candidates according to polls conducted by various polling organizations.
```{r US_polls}
source("Election2016_Polls.R")
polls.plotly
```

### National Estimates  

The line represents *HuffPost Pollster's* estimate for overall support.

```{r US_est}
# Comes from `Election2016_Polls.R` script.
est.plotly 
```

```{r eval=FALSE, echo=FALSE}
# Fully annotated time series

# marker1b will denote election day
# 1b is different from 1a in the text placement
marker1b <- list(x="2016-11-15",
                y=midpoint,
                text="Election Day <br> November 11",
                font=list(size=10),
                showarrow=FALSE)

# Trump convention speech
marker2 <- list(x=as.Date("2016-07-21"), 
                y=filter(est.daily, date==as.Date("2016-07-21") & choice=="Trump")$value,
                text="Convention <br> Speech",
                arrowsize=0.7,
                ay=45,
                ax=10,
                font=list(size=10),
                showarrow=TRUE)

# Clinton convention speech
marker3 <- list(x=as.Date("2016-07-28"), 
                y=filter(est.daily, date==as.Date("2016-07-28") & choice=="Clinton")$value,
                text="Convention <br> Speech",
                arrowsize=0.7,
                ay=-30,
                ax=-10,
                font=list(size=10),
                showarrow=TRUE)               



plot.labels <- list(marker1b, marker2, marker3)

# Annotated polling estimate plot
plot_ly(data=est.daily.top2,
            x=date,
            y=value,
            mode="lines + markers + text",
            color=choice,
            colors=c("red", "blue"),
        showlegend=FALSE) %>%
  layout(title="National Polling Overall Estimates", 
         annotations=plot.labels,
         shapes=list(vert.line),
         xaxis=list(title="Date", 
                    #ticktext=ticktext, 
                    #tickvals=tickvals, 
                    #tickmode="array",
                    tickangle=-45, 
                    rangeslider=list(type="date")),
         yaxis=list(title="", ticksuffix="%"))

```

## Electoral Map  

This is the current electoral map according to estimates by *HuffPost Pollster*.  Estimates are made for states with sufficient polling data.

```{r ElectoralMap}

source("Election2016_ElectoralMap.R")

election.map
```




## Campaign Stops {.tabset .tabset-fade .tabset-pills}

The following maps track campaign stops. The data begins on July 31, 2016 (100 days until the Election Day).  

```{r echo=FALSE, eval=FALSE}
# doubt I will use

# Schedule MAP


leaflet() %>%
  addTiles() %>%
  addMarkers(data=filter(schedule.df, clinton==TRUE), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             group="Clinton (D)",
             icon=dem.icon) %>%
  addMarkers(data=filter(schedule.df, kaine==TRUE), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             group="Kaine (D)",
             icon=dem.icon) %>%
  addMarkers(data=filter(schedule.df, trump==TRUE), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             group="Trump (R)",
             icon=repub.icon) %>%  
  addMarkers(data=filter(schedule.df, pence==TRUE), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             group="Pence (R)",
             icon=repub.icon) %>%
  addLayersControl(overlayGroups=c("Clinton (D)", "Kaine (D)", 
                                   "Trump (R)", "Pence (R)"),
                   options = layersControlOptions(collapsed = FALSE)) 


```

### Today

```{r tour_today}
source("Election2016_ScheduleScrape.R")
source("Election2016_TourSchedule.R")

map.today
```




```{r echo=FALSE, eval=FALSE}
# probably won't use

# Partitioning campaign stops by day, week, and all
# Some days, no candidate makes a campaign stop
# In that case, feeding plotly an empty data set causes an error
# Therefore, you must create if-else conditions to prevent this from happening.

# `map.not.today` includes all stops except for today.
map.not.today <- leaflet() %>%
  addTiles() %>% 
  addMarkers(data=filter(schedule.df, party=="republican"), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             icon=repub.icon,
             group="All") %>% 
  addMarkers(data=filter(schedule.df, party=="democrat"), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             icon=dem.icon,
             group="All") %>%
  addMarkers(data=filter(schedule.df, 
                         date <= Sys.Date() & 
                           date > Sys.Date() - 7  & 
                           party=="republican"), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             icon=repub.icon,
             group="Last 7 Days") %>%
  addMarkers(data=filter(schedule.df, 
                         date <= Sys.Date() & 
                           date > Sys.Date() - 7  & 
                           party=="democrat"), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             icon=dem.icon,
             group="Last 7 Days") %>%
  addLayersControl(baseGroups=c("Today", "Last 7 Days", "All"), 
                   options = layersControlOptions(collapsed = FALSE))




if (filter(schedule.df, date == Sys.Date() & party=="republican") %>% nrow > 0
    &
    filter(schedule.df, date == Sys.Date() & party=="democrat") %>% nrow > 0
    ) {
  map.not.today %>%
    addMarkers(data=filter(schedule.df, date==Sys.Date() & party=="republican"),
               lng=~longitude, lat=~latitude,
               popup=~popup_label,
               icon=repub.icon,
               group="Today") %>%
    addMarkers(data=filter(schedule.df, date==Sys.Date() & party=="democrat"), 
             lng=~longitude, lat=~latitude,
             popup=~popup_label,
             icon=dem.icon,
             group="Today")
  } else if (filter(schedule.df, date == Sys.Date() & 
                    party=="republican") %>%
    nrow > 0) {
      map.not.today %>%
    addMarkers(data=filter(schedule.df, date==Sys.Date() & party=="republican"),
               lng=~longitude, lat=~latitude,
               popup=~popup_label,
               icon=repub.icon,
               group="Today")
    } else if (filter(schedule.df, date == Sys.Date() & 
           party=="democrat") %>%
    nrow > 0) {
      map.not.today %>%
        addMarkers(data=filter(schedule.df, date==Sys.Date() & party=="democrat"),
               lng=~longitude, lat=~latitude,
               popup=~popup_label,
               icon=dem.icon,
               group="Today")
    } else {
      map.not.today
    }



```

### Yesterday

```{r tour_yesterday}
# See scripts
#   `Election2016_ScheduleScrape.R`
#   `Election2016_TourSchedule.R`
#   for source.
map.yesterday
```

### Last Three Days

```{r tour_last3}
# See scripts
#   `Election2016_ScheduleScrape.R`
#   `Election2016_TourSchedule.R`
#   for source.
map.last3days
```

### Last 7 Days

```{r tour_last7}
# See scripts
#   `Election2016_ScheduleScrape.R`
#   `Election2016_TourSchedule.R`
#   for source.
map.last7days
```

### Last 30 Days  
```{r tour_last30}
# See scripts
#   `Election2016_ScheduleScrape.R`
#   `Election2016_TourSchedule.R`
#   for source.
map.last30days
```

### Since July 31, 2016

```{r tour_all}
# See scripts
#   `Election2016_ScheduleScrape.R`
#   `Election2016_TourSchedule.R`
#   for source.
map.100days
```

## Battleground States  {.tabset .tabset-fade .tabset-pills}
A [source](http://www.nytimes.com/2016/07/31/us/politics/donald-trump-presidential-race.html) within the Trump campaign designated four must-win states: Ohio, Pennsylvania, Florida, and North Carolina.

<br>

### Florida

**Florida Polling Estimate on `r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`**
```{r FL_table}
slug <- "2016-florida-presidential-general-election-trump-vs-clinton"

source("Election2016_EstTable.R")

candidate.DT
```

<br>

#### Florida Polling Data {.tabset .tabset-fade .tabset-pills}

##### Florida Polls

```{r FL_polls}
source("Election2016_Polls.R")

# Polling data
polls.plotly
```

##### Florida Estimates
```{r FL_est}
#source("Election2016_Est.R")
# Overlay estimates with polling data
est.plotly

```


### North Carolina  

**North Carolina Polling Estimate on `r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`**
```{r NC_table}
slug <- "2016-north-carolina-president-trump-vs-clinton"

source("Election2016_EstTable.R")

candidate.DT
```

<br>

#### North Carolina Polling Data {.tabset .tabset-fade .tabset-pills}

##### North Carolina Polls

```{r NC_polls}
source("Election2016_Polls.R")

# Polling data
polls.plotly
```

##### North Carolina Estimates
```{r NC_est}
#source("Election2016_Est.R")
# Overlay estimates with polling data
est.plotly
```

### Ohio  

**Ohio Polling Estimate on `r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`**
```{r OH_table}
slug <- "2016-ohio-president-trump-vs-clinton"

source("Election2016_EstTable.R")

candidate.DT
```

<br>

#### Ohio Polling Data {.tabset .tabset-fade .tabset-pills}

##### Ohio Polls

```{r OH_polls}
source("Election2016_Polls.R")

# Polling data
polls.plotly
```

##### Ohio Estimates
```{r OH_est}
#source("Election2016_Est.R")
# Overlay estimates with polling data
est.plotly

```

### Pennsylvania  

**Pennsylvania Polling Estimate on `r paste0(format(Sys.Date(), format='%B %d'), ', 2016')`**
```{r PA_table}
slug <- "2016-pennsylvania-president-trump-vs-clinton"

source("Election2016_EstTable.R")

candidate.DT
```

<br>

#### Pennsylvania Polling Data {.tabset .tabset-fade .tabset-pills}

##### Pennsylvania Polls

```{r PA_polls}
source("Election2016_Polls.R")

# Polling data
polls.plotly
```

##### Pennsylvania Estimates
```{r PA_est}
#source("Election2016_Est.R")
# Overlay estimates with polling data
est.plotly

```